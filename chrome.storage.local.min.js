if(__DEV__&&console.log("def"),"undefined"!=typeof window&&!(window.chrome&&window.chrome.storage&&window.chrome.storage.local)&&window.localStorage){var window_localStorage=window.localStorage,prefix="chrome.storage.local.",__listeners=[],isFunc=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},addListener=function(a){isFunc(a)&&(console.log("adding onChanged Listener",a),__listeners.push(a))},fireChange=function(a){if(0!==__listeners.length){for(var b={},c=Object.keys(a),d=a.constructor===Array,e=0;e<c.length;e++){var f=c[e];b[f]={newValue:d?null:a[f]}}__listeners.forEach(function(a){a.call(null,b,"local")})}},shiv={set:function(a,b){window.setTimeout(function(){for(var c=Object.keys(a),d=0;d<c.length;d++)window_localStorage.setItem(prefix+c[d],JSON.stringify(a[c[d]]));b&&window.setTimeout(b,0),fireChange(a)},0)},get:function(a,b){window.setTimeout(function(){var c=[],d={},e={},f=0,g="";if(null===a)for(f=0;f<window_localStorage.length;f++)g=window_localStorage.key(f),g.substr(0,prefix.length)===prefix&&(e[g.substr(prefix.length)]=JSON.parse(window_localStorage.getItem(g)));else{switch(Object.prototype.toString.call(a)){case"[object Array]":c=a;break;case"[object Object]":c=Object.keys(a),d=a;break;case"[object String]":c=[a]}for(f=0;f<c.length;f++)g=c[f],window_localStorage.hasOwnProperty(prefix+g)?e[g]=JSON.parse(window_localStorage.getItem(prefix+g)):d.hasOwnProperty(g)&&(e[g]=d[g])}b&&b(e)},0)},getBytesInUse:function(a,b){window.setTimeout(function(){b(-1)},0)},remove:function(a,b){window.setTimeout(function(){var c=[];for(c="string"==typeof a?[a]:a,i=0;i<c.length;i++)key=c[i],window_localStorage.hasOwnProperty(prefix+key)&&window_localStorage.removeItem(prefix+key);b&&b()},0)},clear:function(){var a=[];for(i=window_localStorage.length;i>0;i--)key=window_localStorage.key(i-1),key.substr(0,prefix.length)===prefix&&(window_localStorage.removeItem(key),a.push(key))}};window.chrome?window.chrome.storage={local:shiv,onChanged:{addListener:addListener}}:window.chrome={storage:{local:shiv,onChanged:{addListener:addListener}}}}